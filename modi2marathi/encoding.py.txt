import os
import json
from tqdm import tqdm

LABEL_DIR = '/content/drive/MyDrive/modi2marathi/modi_dataset/labels'  # adjust if needed
OUTPUT_DIR = '/content/drive/MyDrive/modi2marathi'  # where to save the json files

# Step 1: Collect unique characters from all label files
unique_chars = set()
for filename in tqdm(os.listdir(LABEL_DIR)):
    if filename.endswith(".txt"):
        with open(os.path.join(LABEL_DIR, filename), 'r', encoding='utf-8') as f:
            text = f.read()
            unique_chars.update(text)

# Step 2: Sort characters (optional, for reproducibility)
# unique_chars = sorted(list(unique_chars))
unique_chars = list(unique_chars)


# Step 3: Create mappings
char_to_idx = {"<BLANK>": 0}  # Required for CTC loss
for idx, ch in enumerate(unique_chars, start=1):
    char_to_idx[ch] = idx

idx_to_char = {idx: ch for ch, idx in char_to_idx.items()}

# Step 4: Save the mappings
with open(os.path.join(OUTPUT_DIR, "char_to_idx.json"), "w", encoding='utf-8') as f:
    json.dump(char_to_idx, f, ensure_ascii=False, indent=4)

with open(os.path.join(OUTPUT_DIR, "idx_to_char.json"), "w", encoding='utf-8') as f:
    json.dump(idx_to_char, f, ensure_ascii=False, indent=4)

print(f"âœ… Vocabulary generated with {len(char_to_idx)} characters.")

